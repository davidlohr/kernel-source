From 8efe1223d73c218ce7e8b2e0e9aadb974b582d7f Mon Sep 17 00:00:00 2001
From: Tejun Heo <tj@kernel.org>
Date: Fri, 20 Sep 2019 13:39:57 -0700
Subject: [PATCH] workqueue: Fix missing kfree(rescuer) in destroy_workqueue()
Git-commit: 8efe1223d73c218ce7e8b2e0e9aadb974b582d7f
Patch-mainline: v5.5-rc1
References: bsc#1210460

Signed-off-by: Tejun Heo <tj@kernel.org>
Reported-by: Qian Cai <cai@lca.pw>
Fixes: def98c84b6cd ("workqueue: Fix spurious sanity check failures in destroy_workqueue()")
Acked-by: Petr Mladek <pmladek@suse.com>

---
 kernel/workqueue.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/kernel/workqueue.c b/kernel/workqueue.c
index 93e20f5330fc..3f067f1d72e3 100644
--- a/kernel/workqueue.c
+++ b/kernel/workqueue.c
@@ -4345,6 +4345,7 @@ void destroy_workqueue(struct workqueue_struct *wq)
 
 		/* rescuer will empty maydays list before exiting */
 		kthread_stop(rescuer->task);
+		kfree(rescuer);
 	}
 
 	/* sanity checks */
-- 
2.35.3

